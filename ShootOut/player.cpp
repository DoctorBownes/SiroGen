#include "player.h"

Player::Player()
{

	static char bulletcanvas[]
	{
		0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,
		0xd,0xd,0x0,0x0,
		0x0,0x0,0x0,0x0
	};

	static char bulletcanvas2[]
	{
		0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,
		0xe,0x1,0x0,0x0,
		0x0,0x0,0x0,0x0
	};

	static char bulletcanvas3[]
	{
		0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,
		0x0,0x1,0x0,0x0,
		0x0,0x0,0x0,0x0
	};

	bulletAnim = new SpriteAnimation();
	this->bulletAnim->AddSprite(bulletcanvas, 4, 4);
	this->bulletAnim->AddSprite(bulletcanvas2, 4, 4);
	this->bulletAnim->AddSprite(bulletcanvas3, 4, 4);

	static char doncanvas[]
	{
		0x0,0x0,0xf,0xf,0xf,0xf,0x0,0x0,
		0x0,0xe,0xe,0xe,0x1,0x1,0x0,0x0,
		0x0,0x0,0xf,0xf,0xe,0xe,0xe,0x0,
		0x0,0x0,0xf,0xf,0x1,0xf,0x0,0x0,
		0x0,0x0,0xf,0xf,0xf,0xf,0xf,0x0,
		0x0,0x0,0xf,0xf,0xf,0xf,0x0,0x0,
		0x0,0x0,0x0,0xf,0xf,0x0,0x0,0x0,
		0x0,0xf,0xe,0xf,0x1,0xf,0xe,0x0,
		0xf,0xf,0xf,0xe,0x1,0xe,0xf,0xf,
		0xf,0xf,0xf,0xf,0xe,0xf,0xf,0xf,
		0xf,0xf,0xf,0xf,0xe,0xf,0xf,0xf,
		0xe,0xe,0xf,0xf,0xf,0xf,0xf,0xe,
		0x0,0xf,0xf,0xf,0xf,0xf,0xf,0x0,
		0x0,0xf,0xf,0xf,0x0,0xf,0xf,0x0,
		0x0,0xf,0xf,0x0,0x0,0xf,0xf,0x0,
		0x0,0xf,0xf,0xf,0x0,0xf,0xf,0xf
	};

	static char doncanvas1[]
	{
		0x0,0x0,0xf,0xf,0xf,0xf,0x0,0x0,
		0x0,0xe,0xe,0xe,0x1,0x1,0x0,0x0,
		0x0,0x0,0xf,0xf,0xe,0xe,0xe,0x0,
		0x0,0x0,0xf,0xf,0x1,0xf,0x0,0x0,
		0x0,0x0,0xf,0xf,0xf,0xf,0xf,0x0,
		0x0,0x0,0xf,0xf,0xf,0xf,0x0,0x0,
		0x0,0x0,0x0,0xf,0xf,0x0,0x0,0x0,
		0x0,0xf,0xe,0xf,0x1,0xf,0xe,0x0,
		0xf,0xf,0xf,0xe,0x1,0xe,0xf,0xf,
		0xf,0xf,0xf,0xf,0xe,0xf,0xf,0xf,
		0xf,0xf,0xf,0xf,0xe,0xf,0xf,0xf,
		0xe,0xe,0xf,0xf,0xf,0xf,0xf,0xe,
		0x0,0xf,0xf,0xf,0xf,0xf,0xf,0x0,
		0x0,0xf,0xf,0xf,0x0,0xf,0xf,0x0,
		0x0,0xf,0xf,0x0,0x0,0xf,0xf,0xf,
		0x0,0xf,0xf,0xf,0x0,0x0,0x0,0x0
	};

	static char doncanvas2[]
	{
		0x0,0x0,0xf,0xf,0xf,0xf,0x0,0x0,
		0x0,0xe,0xe,0xe,0x1,0x1,0x0,0x0,
		0x0,0x0,0xf,0xf,0xe,0xe,0xe,0x0,
		0x0,0x0,0xf,0xf,0x1,0xf,0x0,0x0,
		0x0,0x0,0xf,0xf,0xf,0xf,0xf,0x0,
		0x0,0x0,0xf,0xf,0xf,0xf,0x0,0x0,
		0x0,0x0,0x0,0xf,0xf,0x0,0x0,0x0,
		0x0,0xf,0xe,0xf,0x1,0xf,0xe,0x0,
		0xf,0xf,0xf,0xe,0x1,0xe,0xf,0xf,
		0xf,0xf,0xf,0xf,0xe,0xf,0xf,0xf,
		0xf,0xf,0xf,0xf,0xe,0xf,0xf,0xf,
		0xe,0xe,0xf,0xf,0xf,0xf,0xf,0xe,
		0x0,0xf,0xf,0xf,0xf,0xf,0xf,0x0,
		0x0,0xf,0xf,0x0,0x0,0xf,0xf,0x0,
		0x0,0xf,0xf,0xf,0x0,0xf,0xf,0x0,
		0x0,0x0,0x0,0x0,0x0,0xf,0xf,0xf
	};

	this->walkAnim = new SpriteAnimation();
	this->walkAnim->AddSprite(doncanvas, 8, 16, 0.0f);
	this->walkAnim->AddSprite(doncanvas1, 8, 16, 0.2f);
	this->walkAnim->AddSprite(doncanvas2, 8, 16, 0.2f);

	static char drawcanvas1[] =
	{
		0x0,0x0,0x0,0x0,0x0,0xf,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xe,0xe,0xe,0x1,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0x0,0xf,0xf,0xe,0xe,0xe,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0x0,0xf,0xf,0x1,0xf,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0x0,0xf,0xf,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0x0,0xf,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0x0,0x0,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xf,0xe,0xf,0x1,0xf,0xe,0xf,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0xf,0xf,0xf,0xe,0x1,0xe,0xf,0xf,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0xf,0xf,0xf,0xf,0xe,0xe,0xf,0xf,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0xf,0xf,0xf,0xf,0xe,0xe,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0xe,0xe,0xf,0xf,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xf,0xf,0xf,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xf,0xf,0xf,0x0,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xf,0xf,0x0,0x0,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xf,0xf,0xf,0x0,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0
	};

	static char drawcanvas2[] =
	{
		0x0,0x0,0x0,0x0,0x0,0xf,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xe,0xe,0xe,0x1,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0x0,0xf,0xf,0xe,0xe,0xe,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0x0,0xf,0xf,0x1,0xf,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0x0,0xf,0xf,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0x0,0xf,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0x0,0x0,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xf,0xe,0xf,0x1,0xf,0xe,0xf,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0xf,0xf,0xf,0xe,0x1,0xe,0x1,0x1,0xf,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0xf,0xf,0xf,0xf,0xe,0x1,0x1,0xe,0xf,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0xf,0xf,0xf,0xf,0xe,0xf,0xf,0xe,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0xe,0xe,0xf,0xf,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xf,0xf,0xf,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xf,0xf,0xf,0x0,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xf,0xf,0x0,0x0,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xf,0xf,0xf,0x0,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0
	};

	static char drawcanvas3[] =
	{
		0x0,0x0,0x0,0x0,0x0,0xf,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xe,0xe,0xe,0x1,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0x0,0xf,0xf,0xe,0xe,0xe,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0x0,0xf,0xf,0x1,0xf,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0x0,0xf,0xf,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0x0,0xf,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0x0,0x0,0xf,0xf,0x0,0x0,0x0,0x0,0x1,0x1,0x1,0x1,
		0x0,0x0,0x0,0x0,0xf,0xe,0xf,0x1,0xf,0xe,0xf,0xf,0xe,0xe,0x0,0x0,
		0x0,0x0,0x0,0xf,0xf,0xf,0xe,0x1,0xe,0xf,0xf,0xf,0xe,0x0,0x0,0x0,
		0x0,0x0,0x0,0xf,0xf,0xf,0xf,0xe,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0xf,0xf,0xf,0xf,0xe,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0xe,0xe,0xf,0xf,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xf,0xf,0xf,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xf,0xf,0xf,0x0,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xf,0xf,0x0,0x0,0xf,0xf,0x0,0x0,0x0,0x0,0x0,0x0,
		0x0,0x0,0x0,0x0,0xf,0xf,0xf,0x0,0xf,0xf,0xf,0x0,0x0,0x0,0x0,0x0
	};

	this->drawAnim = new SpriteAnimation();
	this->drawAnim->AddSprite(drawcanvas1, 16, 16, 0.2f);
	this->drawAnim->AddSprite(drawcanvas2, 16, 16, 0.2f);
	this->drawAnim->AddSprite(drawcanvas3, 16, 16, 0.2f);
	bullet = new Entity();
	bullet->AddComponent<Animation>();
	bullet->AddComponent<Collider>()->SetUpSquare(0, 0, 0.125f, 0.125f);
	bullet->GetComponent<Animation>()->PlayAnimation(bulletAnim);

	this->AddComponent<Animation>();
	this->AddComponent<Collider>()->SetUpSquare(0, 0, 8, 16);
}

Player::~Player()
{
	delete drawAnim;
	delete walkAnim;
	delete bulletAnim;
}

void Player::update(float deltaTime)
{
	if (haspressed)
	{
		if (GetComponent<Animation>()->isAnimationFinished(drawAnim))
		{
			Parent->Removechild(bullet);
			bullet->transform.position.x = transform.position.x + 10 * direction;
			bullet->transform.position.y = transform.position.y + 2;
			Parent->Addchild(bullet);
			bullet->GetComponent<Animation>()->ResumeAnimation(0);
			haspressed = false;
			bulletspawned = true;
		}
	}
	if (bulletspawned)
	{
		bullet->transform.position.x += 50 * deltaTime * direction;
		if (bullet->GetComponent<Animation>()->frame == 2)
		{
			bullet->GetComponent<Animation>()->PauseAnimation(2);
		}
	}
	if (score < 1)
	{
		Parent->Removechild(bullet);
		Parent->Removechild(this);
	}
}

void Player::SetColor(uint8_t color)
{
	walkAnim->GetArray().at(0).first->blendColor = color;
	walkAnim->GetArray().at(1).first->blendColor = color;
	walkAnim->GetArray().at(2).first->blendColor = color;

	drawAnim->GetArray().at(0).first->blendColor = color;
	drawAnim->GetArray().at(1).first->blendColor = color;
	drawAnim->GetArray().at(2).first->blendColor = color;
}

void Player::Shoot()
{
	haspressed = true;
	drawAnim->hasPriority = true;
	this->GetComponent<Animation>()->PlayAnimation(drawAnim, false);
}